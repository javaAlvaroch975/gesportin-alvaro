package net.ausiasmarch.gesportin.service;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.stereotype.Service;

import net.ausiasmarch.gesportin.entity.ArticuloEntity;
import net.ausiasmarch.gesportin.entity.CompraEntity;
import net.ausiasmarch.gesportin.entity.FacturaEntity;
import net.ausiasmarch.gesportin.exception.ResourceNotFoundException;
import net.ausiasmarch.gesportin.repository.ArticuloRepository;
import net.ausiasmarch.gesportin.repository.CompraRepository;
import net.ausiasmarch.gesportin.repository.FacturaRepository;

@Service
public class CompraService {

    @Autowired
    CompraRepository oCompraRepository;

    @Autowired
    ArticuloRepository oArticuloRepository;

    @Autowired
    FacturaRepository oFacturaRepository;

    @Autowired
    AleatorioService oAleatorioService;

    public Long fill(Long cantidad) {

        for (long j = 0; j < cantidad; j++) {
            // crea entity compra y la rellena con datos aleatorios
            CompraEntity oCompraEntity = new CompraEntity();
            // generar cantidad aleatoria entre 1 y 50
            oCompraEntity.setCantidad(oAleatorioService.GenerarNumeroAleatorioEnteroEnRango(1, 50));
            // generar id_articulo e id_factura aleatorios entre 1 y 1000
            oCompraEntity.setId_articulo((long) oAleatorioService.GenerarNumeroAleatorioEnteroEnRango(1, 1000));
            oCompraEntity.setId_factura((long) oAleatorioService.GenerarNumeroAleatorioEnteroEnRango(1, 1000));
            // generar precio aleatorio entre 1.00 y 100.00
            double precio = oAleatorioService.GenerarNumeroAleatorioEnteroEnRango(100, 10000) / 100.0;
            oCompraEntity.setPrecio(java.math.BigDecimal.valueOf(precio));
            // guardar entity en base de datos
            oCompraRepository.save(oCompraEntity);
        }
        return oCompraRepository.count();
    }

    // ----------------------------CRUD---------------------------------
    public CompraEntity get(Long id) {
        return oCompraRepository.findById(id).orElseThrow(() -> new ResourceNotFoundException("Compra not found"));
    }

    public Long create(CompraEntity compraEntity) {
        oCompraRepository.save(compraEntity);
        return compraEntity.getId();
    }

    public Long update(CompraEntity compraEntity) {
        CompraEntity existingCompra = oCompraRepository.findById(compraEntity.getId())
                .orElseThrow(() -> new ResourceNotFoundException("Compra not found"));
        existingCompra.setCantidad(compraEntity.getCantidad());
        existingCompra.setPrecio(compraEntity.getPrecio());
        existingCompra.setId_articulo(compraEntity.getId_articulo());
        existingCompra.setId_factura(compraEntity.getId_factura());
        oCompraRepository.save(existingCompra);
        return existingCompra.getId();
    }

    public Long delete(Long id) {
        oCompraRepository.deleteById(id);
        return id;
    }

    public Page<CompraEntity> getPage(Pageable oPageable) {
        return oCompraRepository.findAll(oPageable);
    }

    public Long count() {
        return oCompraRepository.count();
    }

    // vaciar tabla compra (solo administrador m√°s adelante)
    public Long empty() {
        Long total = oCompraRepository.count();
        oCompraRepository.deleteAll();
        return total;
    }

}
